



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="The WakaamaNode (lwM2M library) documentation.">
      
      
      
        <meta name="author" content="David GrÃ¤ff">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.3">
    
    
      
        <title>Connection API - WakaamaNode</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.8d40d89b.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="red" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#connectiondevice-api" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="WakaamaNode" class="md-header-nav__button md-logo">
          
            <img src="../../assets/logo_s.webp" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                WakaamaNode
              </span>
              <span class="md-header-nav__topic">
                Connection API
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/Openhab-Nodes/wakaamaNode/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Openhab-Nodes/wakaamaNode
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="Welcome" class="md-tabs__link">
        Welcome
      </a>
    
  </li>

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="./" title="Connection API" class="md-tabs__link md-tabs__link--active">
          Connection API
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../about/" title="Objects API" class="md-tabs__link">
          Objects API
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../advanced-usage/custom-platform/" title="Advanced usage" class="md-tabs__link">
          Advanced usage
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../others/limitations-and-known-issues/" title="Others" class="md-tabs__link">
          Others
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../../assets/logo_s.webp" width="48" height="48">
      
    </span>
    WakaamaNode
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/Openhab-Nodes/wakaamaNode/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Openhab-Nodes/wakaamaNode
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Welcome" class="md-nav__link">
      Welcome
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../quickstart/getting-started/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Connection API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Connection API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Connection API
      </label>
    
    <a href="./" title="Connection API" class="md-nav__link md-nav__link--active">
      Connection API
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#connection-api" title="Connection API" class="md-nav__link">
    Connection API
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" title="Example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#provide-device-information-api" title="Provide device information API" class="md-nav__link">
    Provide device information API
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" title="Example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#firmware-update-ota" title="Firmware update / OTA" class="md-nav__link">
    Firmware update / OTA
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Objects API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Objects API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../about/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../objects-registry/" title="Registry objects" class="md-nav__link">
      Registry objects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../objects-custom/" title="Custom objects" class="md-nav__link">
      Custom objects
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../objects-custom-cpp-example/" title="Custom objects /CPP Example" class="md-nav__link">
      Custom objects /CPP Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../objects-custom-c-example/" title="Custom objects /C Example" class="md-nav__link">
      Custom objects /C Example
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Advanced usage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Advanced usage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-usage/custom-platform/" title="Custom platform" class="md-nav__link">
      Custom platform
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-usage/custom-network/" title="Custom network stack" class="md-nav__link">
      Custom network stack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-usage/ota/" title="Over-the-air updates" class="md-nav__link">
      Over-the-air updates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-usage/deep-sleep/" title="Deep sleep" class="md-nav__link">
      Deep sleep
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Others
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Others
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../others/limitations-and-known-issues/" title="Limitations and known issues" class="md-nav__link">
      Limitations and known issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../others/troubleshooting/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#connection-api" title="Connection API" class="md-nav__link">
    Connection API
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" title="Example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#provide-device-information-api" title="Provide device information API" class="md-nav__link">
    Provide device information API
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" title="Example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#firmware-update-ota" title="Firmware update / OTA" class="md-nav__link">
    Firmware update / OTA
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Openhab-Nodes/wakaamaNode/edit/master/docs/api/connection-api.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="connectiondevice-api">Connection/Device API<a class="headerlink" href="#connectiondevice-api" title="Permanent link">&para;</a></h1>
<p>The connection/device API is implemented in C.
This library is designed to be used as a single instance. You cannot request or manage multiple Wakaama contexts.</p>
<h2 id="connection-api">Connection API<a class="headerlink" href="#connection-api" title="Permanent link">&para;</a></h2>
<p>Include <code class="codehilite">wakaama_simple_client.h</code>.</p>
<div class="codehilite"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @param endpointName The server uses this name to identify a client over multiple sessions</span>
<span class="cm"> * @return A wakaama context.</span>
<span class="cm"> */</span>
<span class="n">lwm2m_context_t</span> <span class="o">*</span> <span class="nf">lwm2m_client_init</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">endpointName</span><span class="p">);</span>
</pre></div>

<p>Initialize wakaame in client mode.
Will allocate objects and initializes them.
This method can only be called once! Close the client context with lwm2m_client_close().</p>
<div class="codehilite"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @brief Return the context created by lwm2m_client_init().</span>
<span class="cm"> * @return A wakaama context.</span>
<span class="cm"> */</span>
<span class="n">lwm2m_context_t</span> <span class="o">*</span> <span class="nf">lwm2m_client_get_context</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">lwm2m_client_close</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>

<p>Close the wakaama client context and release dynamically aquired ressources.
This will not release objects created by lwm2m_object_create.</p>
<div class="codehilite"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Adds a new server to the lwm2m client. The client statemachine will try to connect to this</span>
<span class="cm"> * server in the next iteration (usually caused by calling lwm2m_network_process(context)).</span>
<span class="cm"> * @param shortServerID A unique server id</span>
<span class="cm"> * @param shortServerID The server URI</span>
<span class="cm"> * @param lifetime A lifetime in seconds</span>
<span class="cm"> * @param storing If notifications should be stored and resend if a server connection was interruppted and then reconnected.</span>
<span class="cm"> * @param publicId publicIdentity for DTLS. May be NULL if no secure connection is used.</span>
<span class="cm"> * @param psk Passkey if DTLS is used. May be NULL.</span>
<span class="cm"> * @param pskLen Passkey length. Should be 0 if no passkey is used.</span>
<span class="cm"> * @return Return true if successfully added and false if aborted due to no memory.</span>
<span class="cm"> */</span>
<span class="kt">bool</span> <span class="nf">lwm2m_add_server</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">shortServerID</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">uri</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">lifetime</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">storing</span><span class="p">,</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">publicId</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">psk</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">pskLen</span><span class="p">);</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Unregisteres from a connected server.</span>
<span class="cm"> * @param security_instance_id The security instance id which refers to a specific server</span>
<span class="cm"> */</span>
<span class="kt">bool</span> <span class="nf">lwm2m_unregister_server</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">security_instance_id</span><span class="p">);</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Removes all unregistered server, by removing all related security objects.</span>
<span class="cm"> * Puts the client back to STATE_INITIAL if the server list has been altered.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">lwm2m_remove_unregistered_servers</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Returns the uri of a server by providing the security object id of that server connection.</span>
<span class="cm"> * @param security_instance_id The security instance id which refers to a specific server</span>
<span class="cm"> * @param uriBuffer The destination buffer</span>
<span class="cm"> * @param buffer_len The destination buffer length</span>
<span class="cm"> */</span>
<span class="kt">bool</span> <span class="nf">lwm2m_get_server_uri</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">security_instance_id</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">uriBuffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">buffer_len</span><span class="p">);</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @brief Return true if wakaama is connected to a lwm2m server.</span>
<span class="cm"> * @return</span>
<span class="cm"> */</span>
<span class="kt">bool</span> <span class="nf">lwm2m_is_connected</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>

<h3 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h3>
<p>To setup the library, you would follow the the outlined schema of the following C code:</p>
<div class="codehilite"><pre><span></span><span class="c1">// The client name will be used by the lwm2m server for identification.</span>
<span class="n">lwm2m_context_t</span> <span class="o">*</span> <span class="n">lwm2mH</span> <span class="o">=</span> <span class="n">lwm2m_client_init</span><span class="p">(</span><span class="s">&quot;testClient&quot;</span><span class="p">);</span>
<span class="c1">// Posix and Lwip network support is implemented.</span>
<span class="n">lwm2m_network_init</span><span class="p">(</span><span class="n">lwm2mH</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">// Call the lwm2m state machine (lwm2m_step) periodically. </span>
   <span class="c1">// tv will be used as output variable. Wakaama tells us about the next required call to lwm2m_step().</span>
   <span class="c1">// In this simple example we ignore this request and call the state machine in each main loop cycle.</span>
   <span class="k">struct</span> <span class="n">timeval</span> <span class="n">tv</span> <span class="o">=</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
   <span class="kt">uint8_t</span> <span class="n">result</span> <span class="o">=</span> <span class="n">lwm2m_step</span><span class="p">(</span><span class="n">lwm2mH</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tv</span><span class="p">.</span><span class="n">tv_sec</span><span class="p">);</span>
   <span class="c1">// let the network stack do its thing.</span>
   <span class="n">lwm2m_network_process</span><span class="p">(</span><span class="n">lwm2mH</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Deregisters from the lwm2m server, frees ressources taken by wakaama.</span>
<span class="n">lwm2m_client_close</span><span class="p">();</span>
<span class="c1">// Close the network connection and release network ressoures.</span>
<span class="n">lwm2m_network_close</span><span class="p">(</span><span class="n">lwm2mH</span><span class="p">);</span>
</pre></div>

<h2 id="provide-device-information-api">Provide device information API<a class="headerlink" href="#provide-device-information-api" title="Permanent link">&para;</a></h2>
<p>The library implements the lwm2m device object for you.</p>
<blockquote>
<p>The Device Object provides a range of device related information which can be queried by the LWM2M Server, and a device reboot and factory reset function.</p>
</blockquote>
<p>In this section you learn how to enable some optional information fields
of the device object and how to feed data into that object.</p>
<div class="codehilite"><pre><span></span><span class="n">device_instance_t</span> <span class="o">*</span> <span class="nf">lwm2m_device_data_get</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>

<p>Return the device information object.
Change this object before you connect to a server.</p>
<div class="codehilite"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @param res_id The ressource id of the value you have changed in device_instance_t.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">lwm2m_device_res_has_changed</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">res_id</span><span class="p">);</span>
</pre></div>

<p>Call this if you have changed a ressource in the device_instance_t object.
You only have to do this after you have connected to a lwm2m server.</p>
<p>To change a device information (version number etc), do the following:
<div class="codehilite"><pre><span></span><span class="n">device_instance_t</span><span class="o">*</span> <span class="n">device</span> <span class="o">=</span> <span class="n">lwm2m_device_data_get</span><span class="p">();</span>
<span class="n">device</span><span class="o">-&gt;</span><span class="n">firmware_ver</span> <span class="o">=</span> <span class="s">&quot;1.2&quot;</span><span class="p">;</span>
<span class="n">lwm2m_device_res_has_changed</span><span class="p">(</span><span class="n">RES_O_FIRMWARE_VERSION</span><span class="p">);</span>
</pre></div></p>
<p>Some device information are obtained by calling a function.
The battery level is an example.
Just call <code class="codehilite">lwm2m_device_res_has_changed(RES_O_BATTERY_LEVEL)</code> periodically or after
the battery level has changed and the runtime will retrieve the new data by
from <code class="codehilite">lwm2m_get_bat_level()</code>.</p>
<h3 id="example_1">Example<a class="headerlink" href="#example_1" title="Permanent link">&para;</a></h3>
<p>You need to provide some static c-strings stating the manufacturer, the model_name, device_type,
firmware version and a serial number, before you connect to a lwm2m server (but after you called <code class="codehilite">lwm2m_client_init</code>).
You would do this like in the following example:</p>
<div class="codehilite"><pre><span></span>    <span class="c1">// do initalisation first</span>
    <span class="n">lwm2m_context_t</span> <span class="o">*</span> <span class="n">lwm2mH</span> <span class="o">=</span> <span class="n">lwm2m_client_init</span><span class="p">(</span><span class="s">&quot;testClient&quot;</span><span class="p">);</span>

    <span class="c1">// Get the device object instance.</span>
    <span class="n">device_instance_t</span> <span class="o">*</span> <span class="n">device_data</span> <span class="o">=</span> <span class="n">lwm2m_device_data_get</span><span class="p">();</span>
    <span class="n">device_data</span><span class="o">-&gt;</span><span class="n">manufacturer</span> <span class="o">=</span> <span class="s">&quot;test manufacturer&quot;</span><span class="p">;</span>
    <span class="n">device_data</span><span class="o">-&gt;</span><span class="n">model_name</span> <span class="o">=</span> <span class="s">&quot;test model&quot;</span><span class="p">;</span>
    <span class="n">device_data</span><span class="o">-&gt;</span><span class="n">device_type</span> <span class="o">=</span> <span class="s">&quot;sensor&quot;</span><span class="p">;</span>
    <span class="n">device_data</span><span class="o">-&gt;</span><span class="n">firmware_ver</span> <span class="o">=</span> <span class="s">&quot;1.0&quot;</span><span class="p">;</span>
    <span class="n">device_data</span><span class="o">-&gt;</span><span class="n">serial_number</span> <span class="o">=</span> <span class="s">&quot;140234-645235-12353&quot;</span><span class="p">;</span>
    <span class="c1">// if LWM2M_DEV_INFO_TIME is enabled</span>
    <span class="n">device_data</span><span class="o">-&gt;</span><span class="n">time_offset</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">device_data</span><span class="o">-&gt;</span><span class="n">timezone</span> <span class="o">=</span> <span class="s">&quot;+05:00&quot;</span>
</pre></div>

<p>If you change data after you have connected to a server, you need to call
<code class="codehilite">lwm2m_device_res_has_changed(res_id)</code> after the change.</p>
<h2 id="firmware-update-ota">Firmware update / OTA<a class="headerlink" href="#firmware-update-ota" title="Permanent link">&para;</a></h2>
<p>To enable OTA, define LWM2M_FIRMWARE_UPGRADES in <code class="codehilite">config_wakama.h</code>.</p>
<p>An implementation exist for posix/win32 systems and for Arduino OTA compliant platforms.</p>
<p>Control how firmware updates can be performed by defining 
LWM2M_FIRMWARE_UPGRADE_METHOD to <strong>HTTP</strong>, <strong>HTTPS</strong> or <strong>COAP</strong>, <strong>COAPS</strong>. If you do no define
LWM2M_FIRMWARE_UPGRADE_METHOD, the best option is choosen.
ESP8266 prefers <strong>HTTP</strong>, posix/win32 systems prefer <strong>COAP</strong>.</p>
<p>The Http(s) method signals the lwM2M server that only firmware polling is enabled
and that a URL should be provided where the new firmware can be found.</p>
<p>The Coap(s) method makes the server send the new firmware via coap as an opaque data chunk.
Because that data chunk is expected to be huge and need to be memory buffered, ESP8266 does
not support this method.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../quickstart/getting-started/" title="Getting started" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Getting started
              </span>
            </div>
          </a>
        
        
          <a href="../about/" title="Introduction" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Introduction
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="http://openhab-nodes.github.io/wakaamaNode/" class="md-footer-social__link fa fa-cog"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b438e6c5.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>